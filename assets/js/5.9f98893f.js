(window.webpackJsonp=window.webpackJsonp||[]).push([[5],{344:function(s,a,t){s.exports=t.p+"assets/img/chakanuid.412a6335.png"},403:function(s,a,t){s.exports=t.p+"assets/img/shengchenghaxi.9e536510.png"},404:function(s,a,t){s.exports=t.p+"assets/img/chaxunip.462bf116.png"},405:function(s,a,t){s.exports=t.p+"assets/img/shoucizhixingcloudreve.6ece39fe.png"},406:function(s,a,t){s.exports=t.p+"assets/img/dockerzhanshi.71af0267.gif"},407:function(s,a,t){s.exports=t.p+"assets/img/shoucianzhuangwanbi.cea47b29.png"},408:function(s,a,t){s.exports=t.p+"assets/img/chuangjianmysql.10e676bc.png"},409:function(s,a,t){s.exports=t.p+"assets/img/xiugaipeizhi.522b2f3b.png"},410:function(s,a,t){s.exports=t.p+"assets/img/kaifangduankou.ed772a4e.png"},411:function(s,a,t){s.exports=t.p+"assets/img/huoquzhanghaomima.b58215e0.png"},412:function(s,a,t){s.exports=t.p+"assets/img/peizhiwangzhan.5c432570.png"},413:function(s,a,t){s.exports=t.p+"assets/img/tianjiafanxiangdail.36ac7d31.png"},414:function(s,a,t){s.exports=t.p+"assets/img/peizhifandai.f9ee024f.jpeg"},415:function(s,a,t){s.exports=t.p+"assets/img/shumeipaiyunpan.a8772c2c.png"},416:function(s,a,t){s.exports=t.p+"assets/img/xiazairuanjian.d5f29bb2.png"},417:function(s,a,t){s.exports=t.p+"assets/img/shangchuanruanjian.c29ba9b4.png"},418:function(s,a,t){s.exports=t.p+"assets/img/xhdsh.449fae51.png"},419:function(s,a,t){s.exports=t.p+"assets/img/fangwenwaiwang.76999cda.png"},477:function(s,a,t){"use strict";t.r(a);var e=t(46),n=Object(e.a)({},(function(){var s=this,a=s.$createElement,e=s._self._c||a;return e("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[e("h1",{attrs:{id:"page-2-服务部署"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#page-2-服务部署"}},[s._v("#")]),s._v(" Page-2：服务部署")]),s._v(" "),e("p",[s._v("编写日期：2021年10月1日"),e("br"),s._v("首发日期：2021年10月2日"),e("br"),s._v("最后编辑日期：2021年11月14日")]),s._v(" "),e("div",{staticClass:"custom-block warning"},[e("p",{staticClass:"custom-block-title"},[s._v("WARNING")]),s._v(" "),e("p",[s._v("注意：本节中所设置的各个网络地址只是个人制作时使用的，如有能力者可参考文章底部的“资料与来源支持”设置自己喜欢的网络地址。")])]),s._v(" "),e("h2",{attrs:{id:"基础环境"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#基础环境"}},[s._v("#")]),s._v(" 基础环境")]),s._v(" "),e("ul",[e("li",[e("p",[s._v("宝塔面板基础套件（"),e("RouterLink",{attrs:{to:"/notes/chapter-1/Page-1.html#面板安装"}},[s._v("安装教程")]),s._v(")")],1),s._v(" "),e("ul",[e("li",[e("p",[s._v("Docker管理器")])]),s._v(" "),e("li",[e("p",[s._v("堡塔应用管理器")]),s._v(" "),e("p",[s._v("这里默认你已经具有了该基础")])])])]),s._v(" "),e("li",[e("p",[s._v("Docker网络环境配置")]),s._v(" "),e("p",[s._v("创建自定义网络")]),s._v(" "),e("div",{staticClass:"language-shell line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" docker network create --subnet"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.18")]),s._v(".0.0/24 docker-1\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("p",[s._v("说明：这里选取了172.18.0.0网段，也可以指定其他任意空闲的网段，docker-1为自定义网桥的名字，可自己任意取名。"),e("br"),s._v("注意：这里子网掩码要使用255.255.255.0也就是IP后面的那个24,因为后面要使用iptables配置路由表,我之前使用255.255.0.0 无法配置.所以这里配置成24。")]),s._v(" "),e("p",[e("img",{attrs:{src:t(403),alt:"shengchenghaxi"}})]),s._v(" "),e("p",[s._v("这里输入命令后会生成一段哈希值。"),e("br"),s._v("创建网桥之后,使用“"),e("code",[s._v("ifconfig")]),s._v("”查看 会多出一个网桥,该网桥在docker启动或者重启之后,会自动显示出来。"),e("br")]),s._v(" "),e("p",[e("img",{attrs:{src:t(404),alt:"chaxunip"}})]),s._v(" "),e("p",[s._v("所以他是永久存在的，可以使用命令“"),e("code",[s._v("docker network rm docker-1")]),s._v("”移除网桥。")])])]),s._v(" "),e("h2",{attrs:{id:"cloudreve部署"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#cloudreve部署"}},[s._v("#")]),s._v(" Cloudreve部署")]),s._v(" "),e("p",[s._v("基于Docker")]),s._v(" "),e("div",{staticClass:"language-shell line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[s._v("docker run -d "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n  --name cloudreve "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n  -e "),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("PUID")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1000")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# optional")]),s._v("\n  -e "),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("PGID")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1000")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# optional")]),s._v("\n  -e "),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("TZ")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Asia/Shanghai"')]),s._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# optional")]),s._v("\n  --network docker-1 "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 使用前面准备的网卡")]),s._v("\n  --ip "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.18")]),s._v(".0.2 "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 基于网卡指定容器IP")]),s._v("\n  --restart"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("unless-stopped "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n  -v "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),e("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("PATH")]),s._v(" TO uploads"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(":/cloudreve/uploads "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n  -v "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),e("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("PATH")]),s._v(" TO temp"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(":/downloads "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#1")]),s._v("\n  -v "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),e("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("PATH")]),s._v(" TO config"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(":/cloudreve/config "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n  -v "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),e("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("PATH")]),s._v(" TO db"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(":/cloudreve/db "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n  -v "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),e("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("PATH")]),s._v(" TO avatar"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(":/cloudreve/avatar "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n  xavierniu/cloudreve:latest\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br")])]),e("blockquote",[e("ul",[e("li",[e("p",[s._v("PUID以及PGID的获取方式详见")]),s._v(" "),e("p",[s._v("为什么要使用PUID和PGID参见"),e("a",{attrs:{href:"https://docs.linuxserver.io/general/understanding-puid-and-pgid",target:"_blank",rel:"noopener noreferrer"}},[s._v("Understanding PUID and PGID"),e("OutboundLink")],1),s._v("。")]),s._v(" "),e("p",[s._v("假设当前登陆用户为"),e("code",[s._v("root")]),s._v("，则执行“"),e("code",[s._v("id root")]),s._v("”就会得到类似于下面的一段代码：")]),s._v(" "),e("div",{staticClass:"language-shell line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("uid")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1000")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("root"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("gid")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1001")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("root"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("p",[s._v("则在运行命令中的PUID填入"),e("code",[s._v("1000")]),s._v("，PGID填入"),e("code",[s._v("1001")]),s._v("。")])]),s._v(" "),e("li",[e("p",[e("code",[s._v("<PATH TO uploads>")]),s._v(":上传目录, 例如"),e("code",[s._v("/sharedfolders")])])]),s._v(" "),e("li",[e("p",[e("code",[s._v("<PATH TO temp>")]),s._v(": 临时下载文件夹，需要与Aria的"),e("code",[s._v("/downloads")]),s._v("对应，例如"),e("code",[s._v("/dockercnf/aria2/temp")]),s._v("（如不需要离线下载功能"),e("code",[s._v("#1")]),s._v("可以删除）")])]),s._v(" "),e("li",[e("p",[e("code",[s._v("<PATH TO config>")]),s._v(": 配置文件夹，如"),e("code",[s._v("/dockercnf/cloudreve/config")])])]),s._v(" "),e("li",[e("p",[e("code",[s._v("<PATH TO db>")]),s._v(": 数据库文件夹，如"),e("code",[s._v("/dockercnf/cloudreve/db")])])]),s._v(" "),e("li",[e("p",[e("code",[s._v("<PATH TO avatar>")]),s._v(": 头像文件夹，如"),e("code",[s._v("/dockercnf/cloudreve/avatar")])])])])]),s._v(" "),e("p",[s._v("示例：")]),s._v(" "),e("ol",[e("li",[e("p",[s._v("先获取PUID和PGID")]),s._v(" "),e("p",[s._v("输入“"),e("code",[s._v("id root")]),s._v("”")]),s._v(" "),e("p",[e("img",{attrs:{src:t(344),alt:"chakanuid"}})]),s._v(" "),e("p",[s._v("则在运行命令中的PUID填入"),e("code",[s._v("0")]),s._v("，PGID填入"),e("code",[s._v("0")]),s._v("。")])]),s._v(" "),e("li",[e("p",[s._v("启动容器")]),s._v(" "),e("div",{staticClass:"language-shell line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[s._v("docker run -d --name cloudreve -e "),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("PUID")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" -e "),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("PGID")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" -e "),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("TZ")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Asia/Shanghai"')]),s._v(" --network docker-1 --ip "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.18")]),s._v(".0.2 --restart"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("unless-stopped -v /PAN/A/uploads:/cloudreve/uploads -v /PAN/A/downloads:/downloads -v /DockerConfig/Cloudreve/config:/cloudreve/config -v /DockerConfig/Cloudreve/db:/cloudreve/db -v /DockerConfig/Cloudreve/avatar:/cloudreve/avatar xavierniu/cloudreve:latest\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("p",[e("img",{attrs:{src:t(405),alt:"shoucizhixingcloudreve"}})]),s._v(" "),e("p",[s._v("首次输入命令后，会下载镜像，等待下载完毕会生成哈希值即表明启动成功")]),s._v(" "),e("p",[s._v("也可以在宝塔面板查看，镜像是存在，容器是否是否启动成功")]),s._v(" "),e("p",[e("img",{attrs:{src:t(406),alt:"dockerzhanshi"}})]),s._v(" "),e("p",[e("em",[s._v("至此其实已经完成了Cloudreve的安装，"),e("strong",[s._v("添加反向代理")]),s._v("后即可正常访问网站")])]),s._v(" "),e("p",[e("img",{attrs:{src:t(407),alt:"shoucianzhuangwanbi"}})]),s._v(" "),e("blockquote",[e("p",[s._v("提示：如果至此你已经打算开始使用了，可以在容器首次启动后在宝塔面板点击 Docker管理器-日志 查看初始账号密码，"),e("strong",[s._v("注意这个很重要")]),s._v("（如果你打算配置Mysql数据库就可以无视这个提示）")])])])]),s._v(" "),e("h2",{attrs:{id:"mysql对接-可选"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#mysql对接-可选"}},[s._v("#")]),s._v(" Mysql对接（可选）")]),s._v(" "),e("ol",[e("li",[e("p",[s._v("在堡塔面板创建Mysql")]),s._v(" "),e("p",[s._v("点击 数据库-添加数据库 填入信息并记录提交")]),s._v(" "),e("p",[e("img",{attrs:{src:t(408),alt:"chuangjianmysql"}})]),s._v(" "),e("p",[s._v("注意：需要指定容器IP")])]),s._v(" "),e("li",[e("p",[s._v("配置Cloudreve的数据库信息")]),s._v(" "),e("div",{staticClass:"language-txt line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-txt"}},[e("code",[s._v("[Database]\n; 数据库类型，目前支持 sqlite | mysql\nType = mysql\n; MySQL 端口\nPort = 3306\n; 用户名\nUser = root\n; 密码\nPassword = root\n; 数据库地址\nHost = 127.0.0.1\n; 数据库名称\nName = v3\n; 数据表前缀\nTablePrefix = cd_\n; SQLite 数据库文件路径\nDBFile = cloudreve.db\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br"),e("span",{staticClass:"line-number"},[s._v("15")]),e("br"),e("span",{staticClass:"line-number"},[s._v("16")]),e("br"),e("span",{staticClass:"line-number"},[s._v("17")]),e("br")])]),e("p",[s._v("配置文件所在地址在Docker映射的地址，这里容器映射配置文件的地址是“/DockerConfig/Cloudreve/config/conf.ini”")]),s._v(" "),e("p",[e("img",{attrs:{src:t(409),alt:"xiugaipeizhi"}})]),s._v(" "),e("p",[s._v("添加上述代码，"),e("strong",[s._v("并修改其中账号密码为上一步中创建的数据库的账号密码以及IP地址修改为容器指定IP的网关，例如这里我的网关就要填写“"),e("code",[s._v("172.18.0.1")]),s._v("”")])])]),s._v(" "),e("li",[e("p",[s._v("开放数据库安全端口")]),s._v(" "),e("p",[s._v("因为这里Docker与宝塔面板的关系是平行关系，所以我们Docker里的应用需要访问宝塔面板的Mysql服务时需要开放安全端口。")]),s._v(" "),e("p",[e("img",{attrs:{src:t(410),alt:"kaifangduankou"}})]),s._v(" "),e("p",[s._v("点击 安全 输入"),e("code",[s._v("3306")]),s._v("为Mysql默认的端口地址。")])]),s._v(" "),e("li",[e("p",[s._v("获取账号密码")]),s._v(" "),e("p",[s._v("点击 Docker管理器 然后在配置好数据库"),e("strong",[s._v("首次")]),s._v("进行容器重启就可以查看到账号密码，"),e("strong",[s._v("务必记下")]),s._v("。")]),s._v(" "),e("p",[e("img",{attrs:{src:t(411),alt:"huoquzhanghaomima"}})]),s._v(" "),e("p",[s._v("到此你已成功将数据库移植到了宝塔的Mysql数据库里了，同样，至此你在"),e("strong",[s._v("添加反向代理后")]),s._v("即可正常访问网站可以正常开始使用了。")])])]),s._v(" "),e("h2",{attrs:{id:"aria2部署"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#aria2部署"}},[s._v("#")]),s._v(" Aria2部署")]),s._v(" "),e("p",[s._v("基于Docker")]),s._v(" "),e("div",{staticClass:"language-shell line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[s._v("docker run -d "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n    --name aria2 "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n    --restart unless-stopped "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n    --log-opt max-size"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("1m "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n    -e "),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("PUID")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1000")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n    -e "),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("PGID")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1000")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n    -e "),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("RPC_SECRET")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("SECRET"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n    -p "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("6800")]),s._v(":6800 "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#1")]),s._v("\n    -p "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("6888")]),s._v(":6888 -p "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("6888")]),s._v(":6888/udp "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n    --network docker-1 "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 使用前面准备的网卡")]),s._v("\n    --ip "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.18")]),s._v(".0.3 "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 基于网卡指定容器IP")]),s._v("\n    -v "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),e("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("PATH")]),s._v(" TO config"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(":/config "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n    -v "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),e("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("PATH")]),s._v(" TO temp"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(":/downloads "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n    p3terx/aria2-pro:latest\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br")])]),e("blockquote",[e("ul",[e("li",[e("p",[s._v("PUID以及PGID的获取方式详见")]),s._v(" "),e("p",[s._v("为什么要使用PUID和PGID参见"),e("a",{attrs:{href:"https://docs.linuxserver.io/general/understanding-puid-and-pgid",target:"_blank",rel:"noopener noreferrer"}},[s._v("Understanding PUID and PGID"),e("OutboundLink")],1),s._v("。")]),s._v(" "),e("p",[s._v("假设当前登陆用户为"),e("code",[s._v("root")]),s._v("，则执行“"),e("code",[s._v("id root")]),s._v("”就会得到类似于下面的一段代码：")]),s._v(" "),e("div",{staticClass:"language-shell line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("uid")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1000")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("root"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("gid")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1001")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("root"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("p",[s._v("则在运行命令中的PUID填入"),e("code",[s._v("1000")]),s._v("，PGID填入"),e("code",[s._v("1001")]),s._v("。")])]),s._v(" "),e("li",[e("p",[e("code",[s._v("<SECRET>")]),s._v(": Aria2 RPC密码（你可以去"),e("a",{attrs:{href:"https://miniwebtool.com/zh-cn/random-string-generator/",target:"_blank",rel:"noopener noreferrer"}},[s._v("这里"),e("OutboundLink")],1),s._v("生成随机字符串）。请记下该密码！在后续Cloudreve设置Aria2中会使用。")])]),s._v(" "),e("li",[e("p",[e("code",[s._v("<PATH TO config>")]),s._v(": Aria2的配置文件夹，例如"),e("code",[s._v("/dockercnf/aria2/conf")]),s._v("。")])]),s._v(" "),e("li",[e("p",[e("code",[s._v("<PATH TO temp>")]),s._v(": 临时下载文件夹，需要与Cloudreve的"),e("code",[s._v("/downloads")]),s._v("对应，例如"),e("code",[s._v("/dockercnf/aria2/temp")]),s._v("。")])]),s._v(" "),e("li",[e("p",[s._v("如果不需要外网访问Aria2可以将"),e("code",[s._v("#1")]),s._v("所在行删除。")])])])]),s._v(" "),e("ol",[e("li",[e("p",[s._v("先获取PUID和PGID")]),s._v(" "),e("p",[s._v("输入“"),e("code",[s._v("id root")]),s._v("”")]),s._v(" "),e("p",[e("img",{attrs:{src:t(344),alt:"chakanuid"}})]),s._v(" "),e("p",[s._v("则在运行命令中的PUID填入"),e("code",[s._v("0")]),s._v("，PGID填入"),e("code",[s._v("0")]),s._v("。")])]),s._v(" "),e("li",[e("p",[s._v("启动容器")]),s._v(" "),e("div",{staticClass:"language-shell line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[s._v("docker run -d --name aria2 --restart unless-stopped --log-opt max-size"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("1m -e "),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("PUID")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" -e "),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("PGID")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" -e "),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("RPC_SECRET")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("更改此RPC令牌 -p "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("6800")]),s._v(":6800 -p "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("6888")]),s._v(":6888 -p "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("6888")]),s._v(":6888/udp --network docker-1 --ip "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.18")]),s._v(".0.3 -v /DockerConfig/Aria2/config:/config -v /PAN/A/downloads:/downloads p3terx/aria2-pro:latest\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("p",[s._v("首次输入命令后，会下载镜像，等待下载完毕会生成哈希值即表明启动成功")]),s._v(" "),e("p",[s._v("也可以在宝塔面板查看，镜像是存在，容器是否是否启动成功")]),s._v(" "),e("p",[s._v("这里就不再展示图示了与“Cloudreve部署”时相同")]),s._v(" "),e("div",{staticClass:"custom-block warning"},[e("p",{staticClass:"custom-block-title"},[s._v("WARNING")]),s._v(" "),e("p",[s._v("注意：这一步中的RPC令牌需要记下，配置Cloudreve的离线下载时需要用到")])])])]),s._v(" "),e("p",[e("em",[s._v("这样你的Aria2容器就已经配置好了")]),s._v("（"),e("RouterLink",{attrs:{to:"/notes/chapter-1/Page-3.html#离线下载"}},[s._v("配置Cloudreve的离线下载")]),s._v(")")],1),s._v(" "),e("h2",{attrs:{id:"反向代理"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#反向代理"}},[s._v("#")]),s._v(" 反向代理")]),s._v(" "),e("ol",[e("li",[e("p",[s._v("创建一个网站")]),s._v(" "),e("p",[s._v("点击 网站-添加站点 填入当前“服务器内网”IP地址 点击提交")]),s._v(" "),e("p",[e("img",{attrs:{src:t(412),alt:"peizhiwangzhan"}})])]),s._v(" "),e("li",[e("p",[s._v("修改反向代理配置")]),s._v(" "),e("p",[s._v("先添加反向代理，点击 设置-反向代理-添加反向代理 并填入cloudreve容器绑定的自建网卡IP地址加端口5212 这里就填写“http://172.18.0.2:5212”")]),s._v(" "),e("p",[e("img",{attrs:{src:t(413),alt:"tianjiafanxiangdail"}})]),s._v(" "),e("p",[e("img",{attrs:{src:t(414),alt:"peizhifandai"}})]),s._v(" "),e("p",[s._v("然后修改反向代理的“配置文件”为如下，并使其运行")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v('<IfModule mod_proxy.c>\n    ProxyRequests Off\n    SSLProxyEngine on\n    ProxyPassReverse / http://[YOUR_SERVER_IP]:5212/\n  \tAllowEncodedSlashes NoDecode\n\tProxyPass "/" "http://172.18.0.2:5212/" nocanon\n</IfModule>\n')])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br")])])]),s._v(" "),e("li",[e("p",[s._v("访问站点")]),s._v(" "),e("p",[s._v("这样你就可以通过内网输入第一步创建网站时填写的IP地址进行访问了")]),s._v(" "),e("p",[e("img",{attrs:{src:t(415),alt:"shumeipaiyunpan"}})])])]),s._v(" "),e("h2",{attrs:{id:"内网穿透-可选"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#内网穿透-可选"}},[s._v("#")]),s._v(" 内网穿透（可选）")]),s._v(" "),e("blockquote",[e("p",[s._v("说明：上边我们所作的一切都是在内网的环境，现在内网穿透就是要实现与外网服务器或用户进行通信。这里内网穿透有两个作用，一个是存储策略回调需要内网穿透且需要支持HTTPS，一个是你自己需要通过外网进行传输文件，或者开放给外网的人去使用。"),e("br"),s._v("如果你只是打算在内网使用该云盘，且"),e("strong",[s._v("不使用非本地存储策略")]),s._v("那么你可以无视这一步。"),e("br"),s._v("内网穿透我们需要借助于第三方提供的服务，这里我选取了一种最省钱的方案，小蝴蝶内网穿透他既能满足HTTPS又能满足外网访问虽然带宽很小但他是最省钱的。内网穿透软件对比详见《"),e("RouterLink",{attrs:{to:"/notes/chapter-2/Page-1.html#sakur-frp"}},[s._v("好物推荐")]),s._v("》。当然你也可以选择使用多个内网穿透软件，取各个软件的有点结合进行使用。这里我就不多折腾了！")],1)]),s._v(" "),e("ol",[e("li",[e("p",[s._v("小蝴蝶内网穿透部署")]),s._v(" "),e("p",[s._v("进入购买一个支持https的隧道,我这里购买的就是5元一个月的隧道")]),s._v(" "),e("p",[s._v('然后将内网服务地址填写为"cloudreve容器的IP加上端口5212"')]),s._v(" "),e("p",[s._v("例如我这里填写：172.18.0.2:5212")]),s._v(" "),e("p",[s._v("然后下载软件到")]),s._v(" "),e("p",[e("img",{attrs:{src:t(416),alt:"xiazairuanjian"}})]),s._v(" "),e("p",[s._v("然后解压上传到根目录自己创建的“MYSOFT”文件夹中，并为方便重命名为“xhdnpc”，记得将文件夹的权限更改为777")]),s._v(" "),e("p",[e("img",{attrs:{src:t(417),alt:"shangchuanruanjian"}})]),s._v(" "),e("p",[s._v("然后使用堡塔应用管理器添加该软件，使其正常运行")]),s._v(" "),e("p",[e("img",{attrs:{src:t(418),alt:"xhdsh"}})]),s._v(" "),e("p",[s._v("然后我们就可以通过这里的二级域名进行访问了")]),s._v(" "),e("p",[e("img",{attrs:{src:t(419),alt:"fangwenwaiwang"}})])])]),s._v(" "),e("details",{staticClass:"custom-block details"},[e("summary",[s._v("资料与支持来源：")]),s._v(" "),e("div",{staticClass:"language-text line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("Cloudreve程序Github：\nhttps://github.com/cloudreve/Cloudreve\nCLoudreve官方文档：\nhttps://docs.cloudreve.org/\nCloudreve论坛帮助，反向代理，加载主页出现请求时出现错误 404：\nhttp://forum.cloudreve.org/d/1204/2\n\nCloudreve Docker - NAC：\nhttps://github.com/xavier-niu/cloudreve-docker/blob/master/README-NAC.md\n\nCloudreve的Docker镜像：\nhttps://registry.hub.docker.com/r/xavierniu/cloudreve\nhttps://github.com/xavier-niu/cloudreve-docker\nAira2的Dcoker镜像：\nhttps://registry.hub.docker.com/r/p3terx/aria2-pro\nDocker生成虚拟网卡：\nhttps://blog.csdn.net/liufuwu1/article/details/88096213?ops_request_misc=%257B%2522request%255Fid%2522%253A%2522163325126316780269862694%2522%252C%2522scm%2522%253A%252220140713.130102334.pc%255Fall.%2522%257D&amp;request_id=163325126316780269862694&amp;biz_id=0&amp;utm_medium=distribute.pc_search_result.none-task-blog-2~all~first_rank_ecpm_v1~rank_v31_ecpm-1-88096213.pc_search_result_cache&amp;utm_term=docker+%E6%8C%87%E5%AE%9Aip&amp;spm=1018.2226.3001.4187\n\n网云穿官网：\nhttp://xiaomy.net/\n网云穿树莓派部署教程：\nhttp://neiwangchuantou.cn/archives/74.html\n小蝴蝶内网穿透：\nhttps://www.npsvip.com/\n\n宝塔面板官网：\nhttps://www.bt.cn/\n\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br"),e("span",{staticClass:"line-number"},[s._v("15")]),e("br"),e("span",{staticClass:"line-number"},[s._v("16")]),e("br"),e("span",{staticClass:"line-number"},[s._v("17")]),e("br"),e("span",{staticClass:"line-number"},[s._v("18")]),e("br"),e("span",{staticClass:"line-number"},[s._v("19")]),e("br"),e("span",{staticClass:"line-number"},[s._v("20")]),e("br"),e("span",{staticClass:"line-number"},[s._v("21")]),e("br"),e("span",{staticClass:"line-number"},[s._v("22")]),e("br"),e("span",{staticClass:"line-number"},[s._v("23")]),e("br"),e("span",{staticClass:"line-number"},[s._v("24")]),e("br"),e("span",{staticClass:"line-number"},[s._v("25")]),e("br"),e("span",{staticClass:"line-number"},[s._v("26")]),e("br"),e("span",{staticClass:"line-number"},[s._v("27")]),e("br"),e("span",{staticClass:"line-number"},[s._v("28")]),e("br")])])])])}),[],!1,null,null,null);a.default=n.exports}}]);