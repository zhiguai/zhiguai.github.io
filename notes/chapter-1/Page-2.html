<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Page-2：服务部署 | 吃纸怪的本子</title>
    <meta name="generator" content="VuePress 1.8.2">
    <link rel="icon" href="/logo1.png">
    <meta name="description" content="基于VUEPRESS的个人笔记本">
    
    <link rel="preload" href="/assets/css/0.styles.1dda08d4.css" as="style"><link rel="preload" href="/assets/js/app.237a06eb.js" as="script"><link rel="preload" href="/assets/js/2.85cd07c7.js" as="script"><link rel="preload" href="/assets/js/5.27c12f02.js" as="script"><link rel="prefetch" href="/assets/js/10.18763a80.js"><link rel="prefetch" href="/assets/js/11.0b45bb81.js"><link rel="prefetch" href="/assets/js/12.fa4c5abd.js"><link rel="prefetch" href="/assets/js/13.26d9355b.js"><link rel="prefetch" href="/assets/js/14.9061d27c.js"><link rel="prefetch" href="/assets/js/15.4dbffe06.js"><link rel="prefetch" href="/assets/js/16.2faf0488.js"><link rel="prefetch" href="/assets/js/17.de0271a0.js"><link rel="prefetch" href="/assets/js/18.b7b76cc2.js"><link rel="prefetch" href="/assets/js/19.b57df465.js"><link rel="prefetch" href="/assets/js/20.929f04c4.js"><link rel="prefetch" href="/assets/js/3.ef50f2a9.js"><link rel="prefetch" href="/assets/js/4.c7f9d895.js"><link rel="prefetch" href="/assets/js/6.c284c946.js"><link rel="prefetch" href="/assets/js/7.7340d89e.js"><link rel="prefetch" href="/assets/js/8.9645e6ff.js"><link rel="prefetch" href="/assets/js/9.c511d185.js">
    <link rel="stylesheet" href="/assets/css/0.styles.1dda08d4.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/logo0.png" alt="吃纸怪的本子" class="logo"> <span class="site-name can-hide">吃纸怪的本子</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/index/" class="nav-link">
  首页
</a></div><div class="nav-item"><a href="/notes/" class="nav-link router-link-active">
  笔记本
</a></div> <a href="https://github.com/zhiguai/zhiguai.github.io" target="_blank" rel="noopener noreferrer" class="repo-link">
    Github
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/index/" class="nav-link">
  首页
</a></div><div class="nav-item"><a href="/notes/" class="nav-link router-link-active">
  笔记本
</a></div> <a href="https://github.com/zhiguai/zhiguai.github.io" target="_blank" rel="noopener noreferrer" class="repo-link">
    Github
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>目录</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/notes/" aria-current="page" class="sidebar-link">chapter-0《开始》</a></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><a href="/notes/chapter-1/" class="sidebar-heading clickable router-link-active open"><span>chapter-1《自建一个网盘》</span> <span class="arrow down"></span></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/notes/chapter-1/" aria-current="page" class="sidebar-link">0.前言</a></li><li><a href="/notes/chapter-1/Page-1.html" class="sidebar-link">1.基础准备</a></li><li><a href="/notes/chapter-1/Page-2.html" aria-current="page" class="active sidebar-link">2.服务部署</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/notes/chapter-1/Page-2.html#基础环境" class="sidebar-link">基础环境</a></li><li class="sidebar-sub-header"><a href="/notes/chapter-1/Page-2.html#cloudreve部署" class="sidebar-link">Cloudreve部署</a></li><li class="sidebar-sub-header"><a href="/notes/chapter-1/Page-2.html#mysql对接-可选" class="sidebar-link">Mysql对接（可选）</a></li><li class="sidebar-sub-header"><a href="/notes/chapter-1/Page-2.html#aria2部署" class="sidebar-link">Aria2部署</a></li><li class="sidebar-sub-header"><a href="/notes/chapter-1/Page-2.html#反向代理" class="sidebar-link">反向代理</a></li><li class="sidebar-sub-header"><a href="/notes/chapter-1/Page-2.html#内网穿透-可选" class="sidebar-link">内网穿透（可选）</a></li></ul></li><li><a href="/notes/chapter-1/Page-3.html" class="sidebar-link">3.配置与说明</a></li><li><a href="/notes/chapter-1/Page-4.html" class="sidebar-link">4.拓展与帮助</a></li></ul></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><a href="/notes/chapter-2/" class="sidebar-heading clickable"><span>chapter-2《好物推荐》</span> <span class="arrow right"></span></a> <!----></section></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="page-2-服务部署"><a href="#page-2-服务部署" class="header-anchor">#</a> Page-2：服务部署</h1> <p>编写日期：2021年10月1日<br>首发日期：2021年10月2日<br>最后编辑日期：2021年10月10日</p> <h2 id="基础环境"><a href="#基础环境" class="header-anchor">#</a> 基础环境</h2> <ul><li><p>宝塔面板基础套件（<a href="/notes/chapter-1/Page-1.html#面板安装">安装教程</a>)</p> <ul><li><p>Docker管理器</p></li> <li><p>堡塔应用管理器</p> <p>这里默认你已经具有了该基础</p></li></ul></li> <li><p>Docker网络环境配置</p> <p>创建自定义网络</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token function">sudo</span> docker network create --subnet<span class="token operator">=</span><span class="token number">172.18</span>.0.0/24 docker-1
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>说明：这里选取了172.18.0.0网段，也可以指定其他任意空闲的网段，docker-1为自定义网桥的名字，可自己任意取名。<br>注意：这里子网掩码要使用255.255.255.0也就是IP后面的那个24,因为后面要使用iptables配置路由表,我之前使用255.255.0.0 无法配置.所以这里配置成24。</p> <p><img src="/assets/img/shengchenghaxi.9e536510.png" alt="shengchenghaxi"></p> <p>这里输入命令后会生成一段哈希值。<br>创建网桥之后,使用“<code>ifconfig</code>”查看 会多出一个网桥,该网桥在docker启动或者重启之后,会自动显示出来。<br></p> <p><img src="/assets/img/chaxunip.462bf116.png" alt="chaxunip"></p> <p>所以他是永久存在的，可以使用命令“<code>docker network rm docker-1</code>”移除网桥。</p></li></ul> <h2 id="cloudreve部署"><a href="#cloudreve部署" class="header-anchor">#</a> Cloudreve部署</h2> <p>基于Docker</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>docker run -d <span class="token punctuation">\</span>
  --name cloudreve <span class="token punctuation">\</span>
  -e <span class="token assign-left variable">PUID</span><span class="token operator">=</span><span class="token number">1000</span> <span class="token punctuation">\</span> <span class="token comment"># optional</span>
  -e <span class="token assign-left variable">PGID</span><span class="token operator">=</span><span class="token number">1000</span> <span class="token punctuation">\</span> <span class="token comment"># optional</span>
  -e <span class="token assign-left variable">TZ</span><span class="token operator">=</span><span class="token string">&quot;Asia/Shanghai&quot;</span> <span class="token punctuation">\</span> <span class="token comment"># optional</span>
  --network docker-1 <span class="token punctuation">\</span> <span class="token comment"># 使用前面准备的网卡</span>
  --ip <span class="token number">172.18</span>.0.2 <span class="token punctuation">\</span> <span class="token comment"># 基于网卡指定容器IP</span>
  --restart<span class="token operator">=</span>unless-stopped <span class="token punctuation">\</span>
  -v <span class="token operator">&lt;</span><span class="token environment constant">PATH</span> TO uploads<span class="token operator">&gt;</span>:/cloudreve/uploads <span class="token punctuation">\</span>
  -v <span class="token operator">&lt;</span><span class="token environment constant">PATH</span> TO temp<span class="token operator">&gt;</span>:/downloads <span class="token punctuation">\</span> <span class="token comment">#1</span>
  -v <span class="token operator">&lt;</span><span class="token environment constant">PATH</span> TO config<span class="token operator">&gt;</span>:/cloudreve/config <span class="token punctuation">\</span>
  -v <span class="token operator">&lt;</span><span class="token environment constant">PATH</span> TO db<span class="token operator">&gt;</span>:/cloudreve/db <span class="token punctuation">\</span>
  -v <span class="token operator">&lt;</span><span class="token environment constant">PATH</span> TO avatar<span class="token operator">&gt;</span>:/cloudreve/avatar <span class="token punctuation">\</span>
  xavierniu/cloudreve:latest
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><blockquote><ul><li><p>PUID以及PGID的获取方式详见</p> <p>为什么要使用PUID和PGID参见<a href="https://docs.linuxserver.io/general/understanding-puid-and-pgid" target="_blank" rel="noopener noreferrer">Understanding PUID and PGID<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>。</p> <p>假设当前登陆用户为<code>root</code>，则执行“<code>id root</code>”就会得到类似于下面的一段代码：</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token assign-left variable">uid</span><span class="token operator">=</span><span class="token number">1000</span><span class="token punctuation">(</span>root<span class="token punctuation">)</span> <span class="token assign-left variable">gid</span><span class="token operator">=</span><span class="token number">1001</span><span class="token punctuation">(</span>root<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>则在运行命令中的PUID填入<code>1000</code>，PGID填入<code>1001</code>。</p></li> <li><p><code>&lt;PATH TO uploads&gt;</code>:上传目录, 例如<code>/sharedfolders</code></p></li> <li><p><code>&lt;PATH TO temp&gt;</code>: 临时下载文件夹，需要与Aria的<code>/downloads</code>对应，例如<code>/dockercnf/aria2/temp</code>（如不需要离线下载功能<code>#1</code>可以删除）</p></li> <li><p><code>&lt;PATH TO config&gt;</code>: 配置文件夹，如<code>/dockercnf/cloudreve/config</code></p></li> <li><p><code>&lt;PATH TO db&gt;</code>: 数据库文件夹，如<code>/dockercnf/cloudreve/db</code></p></li> <li><p><code>&lt;PATH TO avatar&gt;</code>: 头像文件夹，如<code>/dockercnf/cloudreve/avatar</code></p></li></ul></blockquote> <p>示例：</p> <ol><li><p>先获取PUID和PGID</p> <p>输入“<code>id root</code>”</p> <p><img src="/assets/img/chakanuid.412a6335.png" alt="chakanuid"></p> <p>则在运行命令中的PUID填入<code>0</code>，PGID填入<code>0</code>。</p></li> <li><p>启动容器</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>docker run -d --name cloudreve -e <span class="token assign-left variable">PUID</span><span class="token operator">=</span><span class="token number">0</span> -e <span class="token assign-left variable">PGID</span><span class="token operator">=</span><span class="token number">0</span> -e <span class="token assign-left variable">TZ</span><span class="token operator">=</span><span class="token string">&quot;Asia/Shanghai&quot;</span> --network docker-1 --ip <span class="token number">172.18</span>.0.2 --restart<span class="token operator">=</span>unless-stopped -v /PAN/A/uploads:/cloudreve/uploads -v /PAN/A/downloads:/downloads -v /DockerConfig/Cloudreve/config:/cloudreve/config -v /DockerConfig/Cloudreve/db:/cloudreve/db -v /DockerConfig/Cloudreve/avatar:/cloudreve/avatar xavierniu/cloudreve:latest
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><img src="/assets/img/shoucizhixingcloudreve.6ece39fe.png" alt="shoucizhixingcloudreve"></p> <p>首次输入命令后，会下载镜像，等待下载完毕会生成哈希值即表明启动成功</p> <p>也可以在宝塔面板查看，镜像是存在，容器是否是否启动成功</p> <p><img src="/assets/img/dockerzhanshi.71af0267.gif" alt="dockerzhanshi"></p> <p><em>至此其实已经完成了Cloudreve的安装，<strong>添加反向代理</strong>后即可正常访问网站</em></p> <p><img src="/assets/img/shoucianzhuangwanbi.cea47b29.png" alt="shoucianzhuangwanbi"></p> <blockquote><p>提示：如果至此你已经打算开始使用了，可以在容器首次启动后在宝塔面板点击 Docker管理器-日志 查看初始账号密码，<strong>注意这个很重要</strong>（如果你打算配置Mysql数据库就可以无视这个提示）</p></blockquote></li></ol> <h2 id="mysql对接-可选"><a href="#mysql对接-可选" class="header-anchor">#</a> Mysql对接（可选）</h2> <ol><li><p>在堡塔面板创建Mysql</p> <p>点击 数据库-添加数据库 填入信息并记录提交</p> <p><img src="/assets/img/chuangjianmysql.10e676bc.png" alt="chuangjianmysql"></p> <p>注意：需要指定容器IP</p></li> <li><p>配置Cloudreve的数据库信息</p> <div class="language-txt line-numbers-mode"><pre class="language-txt"><code>[Database]
; 数据库类型，目前支持 sqlite | mysql
Type = mysql
; MySQL 端口
Port = 3306
; 用户名
User = root
; 密码
Password = root
; 数据库地址
Host = 127.0.0.1
; 数据库名称
Name = v3
; 数据表前缀
TablePrefix = cd_
; SQLite 数据库文件路径
DBFile = cloudreve.db
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><p>配置文件所在地址在Docker映射的地址，这里容器映射配置文件的地址是“/DockerConfig/Cloudreve/config/conf.ini”</p> <p><img src="/assets/img/xiugaipeizhi.522b2f3b.png" alt="xiugaipeizhi"></p> <p>添加上述代码，<strong>并修改其中账号密码为上一步中创建的数据库的账号密码以及IP地址修改为容器指定IP的网关，例如这里我的网关就要填写“<code>172.18.0.1</code>”</strong></p></li> <li><p>开放数据库安全端口</p> <p>因为这里Docker与宝塔面板的关系是平行关系，所以我们Docker里的应用需要访问宝塔面板的Mysql服务时需要开放安全端口。</p> <p><img src="/assets/img/kaifangduankou.ed772a4e.png" alt="kaifangduankou"></p> <p>点击 安全 输入<code>3306</code>为Mysql默认的端口地址。</p></li> <li><p>获取账号密码</p> <p>点击 Docker管理器 然后在配置好数据库<strong>首次</strong>进行容器重启就可以查看到账号密码，<strong>务必记下</strong>。</p> <p><img src="/assets/img/huoquzhanghaomima.b58215e0.png" alt="huoquzhanghaomima"></p> <p>到此你已成功将数据库移植到了宝塔的Mysql数据库里了，同样，至此你在<strong>添加反向代理后</strong>即可正常访问网站可以正常开始使用了。</p></li></ol> <h2 id="aria2部署"><a href="#aria2部署" class="header-anchor">#</a> Aria2部署</h2> <p>基于Docker</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>docker run -d <span class="token punctuation">\</span>
    --name aria2 <span class="token punctuation">\</span>
    --restart unless-stopped <span class="token punctuation">\</span>
    --log-opt max-size<span class="token operator">=</span>1m <span class="token punctuation">\</span>
    -e <span class="token assign-left variable">PUID</span><span class="token operator">=</span><span class="token number">1000</span> <span class="token punctuation">\</span>
    -e <span class="token assign-left variable">PGID</span><span class="token operator">=</span><span class="token number">1000</span> <span class="token punctuation">\</span>
    -e <span class="token assign-left variable">RPC_SECRET</span><span class="token operator">=</span><span class="token operator">&lt;</span>SECRET<span class="token operator">&gt;</span> <span class="token punctuation">\</span>
    -p <span class="token number">6800</span>:6800 <span class="token punctuation">\</span> <span class="token comment">#1</span>
    -p <span class="token number">6888</span>:6888 -p <span class="token number">6888</span>:6888/udp <span class="token punctuation">\</span>
    --network docker-1 <span class="token punctuation">\</span> <span class="token comment"># 使用前面准备的网卡</span>
    --ip <span class="token number">172.18</span>.0.3 <span class="token punctuation">\</span> <span class="token comment"># 基于网卡指定容器IP</span>
    -v <span class="token operator">&lt;</span><span class="token environment constant">PATH</span> TO config<span class="token operator">&gt;</span>:/config <span class="token punctuation">\</span>
    -v <span class="token operator">&lt;</span><span class="token environment constant">PATH</span> TO temp<span class="token operator">&gt;</span>:/downloads <span class="token punctuation">\</span>
    p3terx/aria2-pro:latest
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><blockquote><ul><li><p>PUID以及PGID的获取方式详见</p> <p>为什么要使用PUID和PGID参见<a href="https://docs.linuxserver.io/general/understanding-puid-and-pgid" target="_blank" rel="noopener noreferrer">Understanding PUID and PGID<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>。</p> <p>假设当前登陆用户为<code>root</code>，则执行“<code>id root</code>”就会得到类似于下面的一段代码：</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token assign-left variable">uid</span><span class="token operator">=</span><span class="token number">1000</span><span class="token punctuation">(</span>root<span class="token punctuation">)</span> <span class="token assign-left variable">gid</span><span class="token operator">=</span><span class="token number">1001</span><span class="token punctuation">(</span>root<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>则在运行命令中的PUID填入<code>1000</code>，PGID填入<code>1001</code>。</p></li> <li><p><code>&lt;SECRET&gt;</code>: Aria2 RPC密码（你可以去<a href="https://miniwebtool.com/zh-cn/random-string-generator/" target="_blank" rel="noopener noreferrer">这里<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>生成随机字符串）。请记下该密码！在后续Cloudreve设置Aria2中会使用。</p></li> <li><p><code>&lt;PATH TO config&gt;</code>: Aria2的配置文件夹，例如<code>/dockercnf/aria2/conf</code>。</p></li> <li><p><code>&lt;PATH TO temp&gt;</code>: 临时下载文件夹，需要与Cloudreve的<code>/downloads</code>对应，例如<code>/dockercnf/aria2/temp</code>。</p></li> <li><p>如果不需要外网访问Aria2可以将<code>#1</code>所在行删除。</p></li></ul></blockquote> <ol><li><p>先获取PUID和PGID</p> <p>输入“<code>id root</code>”</p> <p><img src="/assets/img/chakanuid.412a6335.png" alt="chakanuid"></p> <p>则在运行命令中的PUID填入<code>0</code>，PGID填入<code>0</code>。</p></li> <li><p>启动容器</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>docker run -d --name aria2 --restart unless-stopped --log-opt max-size<span class="token operator">=</span>1m -e <span class="token assign-left variable">PUID</span><span class="token operator">=</span><span class="token number">0</span> -e <span class="token assign-left variable">PGID</span><span class="token operator">=</span><span class="token number">0</span> -e <span class="token assign-left variable">RPC_SECRET</span><span class="token operator">=</span>更改此RPC令牌 -p <span class="token number">6800</span>:6800 -p <span class="token number">6888</span>:6888 -p <span class="token number">6888</span>:6888/udp --network docker-1 --ip <span class="token number">172.18</span>.0.3 -v /DockerConfig/Aria2/config:/config -v /PAN/A/downloads:/downloads p3terx/aria2-pro:latest
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>首次输入命令后，会下载镜像，等待下载完毕会生成哈希值即表明启动成功</p> <p>也可以在宝塔面板查看，镜像是存在，容器是否是否启动成功</p> <p>这里就不再展示图示了与“Cloudreve部署”时相同</p> <div class="custom-block warning"><p class="custom-block-title">WARNING</p> <p>注意：这一步中的RPC令牌需要记下，配置Cloudreve的离线下载时需要用到</p></div></li></ol> <p><em>这样你的Aria2容器就已经配置好了</em>（<a href="/notes/chapter-1/Page-3.html#离线下载">配置Cloudreve的离线下载</a>)</p> <h2 id="反向代理"><a href="#反向代理" class="header-anchor">#</a> 反向代理</h2> <ol><li><p>创建一个网站</p> <p>点击 网站-添加站点 填入当前“服务器内网”IP地址 点击提交</p> <p><img src="/assets/img/peizhiwangzhan.5c432570.png" alt="peizhiwangzhan"></p></li> <li><p>修改反向代理配置</p> <p>先添加反向代理，点击 设置-反向代理-添加反向代理 并填入cloudreve容器绑定的自建网卡IP地址加端口5212 这里就填写“http://172.18.0.2:5212”</p> <p><img src="/assets/img/tianjiafanxiangdail.36ac7d31.png" alt="tianjiafanxiangdail"></p> <p>然后修改配置文件</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>&lt;IfModule mod_proxy.c&gt;
    ProxyRequests Off
    SSLProxyEngine on
    ProxyPassReverse / http://[YOUR_SERVER_IP]:5212/
  	AllowEncodedSlashes NoDecode
	ProxyPass &quot;/&quot; &quot;http://172.18.0.2:5212/&quot; nocanon
&lt;/IfModule&gt;
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div></li> <li><p>访问站点</p> <p>这样你就可以通过内网输入第一步创建网站时填写的IP地址进行访问了</p> <p><img src="/assets/img/shumeipaiyunpan.a8772c2c.png" alt="shumeipaiyunpan"></p></li></ol> <h2 id="内网穿透-可选"><a href="#内网穿透-可选" class="header-anchor">#</a> 内网穿透（可选）</h2> <blockquote><p>说明：上边我们所作的一切都是在内网的环境，现在内网穿透就是要实现与外网服务器或用户进行通信。这里内网穿透有两个作用，一个是存储策略回调需要内网穿透且需要支持HTTPS，一个是你自己需要通过外网进行传输文件，或者开放给外网的人去使用。<br>如果你只是打算在内网使用该云盘，且<strong>不使用非本地存储策略</strong>那么你可以无视这一步。<br>内网穿透我们需要借助于第三方提供的服务，这里我选取了一种最省钱的方案，小蝴蝶内网穿透他既能满足HTTPS又能满足外网访问虽然贷款很小但他是最省钱的。内网穿透软件对比详见《<a href="/notes/chapter-2/Page-1.html#sakur-frp">好物推荐</a>》。当然你也可以选择使用多个内网穿透软件，取各个软件的有点结合进行使用。这里我就不多折腾了！</p></blockquote> <ol><li><p>小蝴蝶内网穿透部署</p> <p>进入购买一个支持https的隧道,我这里购买的就是5元一个月的隧道</p> <p>然后将内网服务地址填写为&quot;cloudreve容器的IP加上端口5212&quot;</p> <p>例如我这里填写：172.18.0.2:5212</p> <p>然后下载软件到</p> <p><img src="/assets/img/xiazairuanjian.d5f29bb2.png" alt="xiazairuanjian"></p> <p>然后解压上传到根目录自己创建的“MYSOFT”文件夹中，并为方便重命名为“xhdnpc”，记得将文件夹的权限更改为777</p> <p><img src="/assets/img/shangchuanruanjian.c29ba9b4.png" alt="shangchuanruanjian"></p> <p>然后使用堡塔应用管理器添加该软件，使其正常运行。</p> <p><img src="/assets/img/xhdsh.449fae51.png" alt="xhdsh"></p> <p>然后我们就可以通过这里的二级域名进行访问了</p> <p><img src="/assets/img/fangwenwaiwang.76999cda.png" alt="fangwenwaiwang"></p></li></ol> <details class="custom-block details"><summary>资料与支持来源：</summary> <div class="language-text line-numbers-mode"><pre class="language-text"><code>Cloudreve程序Github：
https://github.com/cloudreve/Cloudreve
CLoudreve官方文档：
https://docs.cloudreve.org/
Cloudreve论坛帮助，反向代理，加载主页出现请求时出现错误 404：
http://forum.cloudreve.org/d/1204/2

Cloudreve Docker - NAC：
https://github.com/xavier-niu/cloudreve-docker/blob/master/README-NAC.md

Cloudreve的Docker镜像：
https://registry.hub.docker.com/r/xavierniu/cloudreve
https://github.com/xavier-niu/cloudreve-docker
Aira2的Dcoker镜像：
https://registry.hub.docker.com/r/p3terx/aria2-pro
Docker生成虚拟网卡：
https://blog.csdn.net/liufuwu1/article/details/88096213?ops_request_misc=%257B%2522request%255Fid%2522%253A%2522163325126316780269862694%2522%252C%2522scm%2522%253A%252220140713.130102334.pc%255Fall.%2522%257D&amp;amp;request_id=163325126316780269862694&amp;amp;biz_id=0&amp;amp;utm_medium=distribute.pc_search_result.none-task-blog-2~all~first_rank_ecpm_v1~rank_v31_ecpm-1-88096213.pc_search_result_cache&amp;amp;utm_term=docker+%E6%8C%87%E5%AE%9Aip&amp;amp;spm=1018.2226.3001.4187

网云穿官网：
http://xiaomy.net/
网云穿树莓派部署教程：
http://neiwangchuantou.cn/archives/74.html
小蝴蝶内网穿透：
https://www.npsvip.com/

宝塔面板官网：
https://www.bt.cn/

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br></div></div></details></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/notes/chapter-1/Page-1.html" class="prev">
        1.基础准备
      </a></span> <span class="next"><a href="/notes/chapter-1/Page-3.html">
        3.配置与说明
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.237a06eb.js" defer></script><script src="/assets/js/2.85cd07c7.js" defer></script><script src="/assets/js/5.27c12f02.js" defer></script>
  </body>
</html>
